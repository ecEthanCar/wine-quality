---
  title: "Red Analysis"
output: pdf_document
---
  
  RED AND WHITE ANALYSIS
```{r}
# Boxplot for wine type vs. quality rating, median distribution is not different
boxplot(quality ~ type, wine)

# we can conclude the distributions are normal
hist(white$quality)
hist(red$quality)

# Test to determine if difference in quality between white and red is significant
quality_red <- wine[wine$type == "red", "quality"]
quality_white <- wine[wine$type == "white", "quality"]

t_result <- t.test(quality_red, quality_white)
t_result
# p-value is very low, there is a significant difference between the mean quality of white and red wines. Considering the two wine are also contextually different, we will analyze and fit each type of wine separately.

```


RED WINE ANALYSIS
```{r}
#reading in the data
library(readr)
library(ggcorrplot)
library(psych)
library(leaps)

winequality_red <- read_delim("~/Desktop/wine-quality/wine+quality+raw/winequality-red.csv", 
                              delim = ";", escape_double = FALSE, trim_ws = TRUE)


#descriptive analysis
# bot plots
boxplot(winequality_red)
describe(winequality_red)
# Compute correlation at 2 decimal places
corr_matrix = round(cor(winequality_red), 2)
corr_matrix
# Compute and show the  result
ggcorrplot(corr_matrix, hc.order = TRUE, type = "lower",
           lab = TRUE)
```
From the analysis of box plot,we can see that free sulfer dioxide and total 
sulfer dioxide is highly variable.

```{r}
#fitting a linear model using all parameters
#linear models
red_lm <- lm( quality ~. , data = winequality_red)
summary(red_lm)

#residuals
# Get the model residuals
model_residuals = red_lm$residuals

# Plot the result of the residuals
hist(model_residuals)
```
we can see that the residuals are slightly normal.




```{r}

#best-subset selection
best = regsubsets(quality~., data = winequality_red, nvmax = 19)
best_summary <- summary(best)
best_summary

#calculating BIC
plot(best_summary$bic, xlab = "Number of Variables", ylab = "BIC", type = "l")
bic_min = which.min(best_summary$bic) 
points(bic_min, best_summary$bic[bic_min], col = "red", cex = 2, pch = 20)


```
BIC graph shows that having 6 number of variable has lowest BIC. So we will choose the 
6 variables from best subset selection: volatile acidity, chlorides, total sulfur dioxide, pH, 
sulphates, and alcohol.


```{r}
#getting test and training dataset and linear model using the 6 co-variates 
#chosen from best subset selection

calculate_test_error <- function(seed) {
  set.seed(seed)
  n <- nrow(winequality_red)
  size <- floor(n * 0.75)  # Corrected to take 75% of the data size for training
  
  # Training the test model
  train_ind <- sample(seq_len(n), size = size)
  trainData <- winequality_red[train_ind, ]
  testData <- winequality_red[-train_ind, ]
  
  # Fit linear model
  model <- lm(quality ~ `volatile acidity` + chlorides + `total sulfur dioxide` + pH + sulphates + alcohol, data = trainData)
  
  # Predicting on test data using the fitted model
  predicted_values <- predict(model, newdata = testData)
  
  # Compute the test error as Root Mean Squared Error (RMSE)
  actual_values <- testData$quality
  error <- sqrt(mean((predicted_values - actual_values)^2))
  return(error)
}

```


```{r}
#average MSE of linear model using 6 coviarates
mse1 <- calculate_test_error(1)
mse2 <- calculate_test_error(2)
mse3 <- calculate_test_error(3)
mse4 <- calculate_test_error(4)
mse5 <- calculate_test_error(5)

print(mean(mse1,mse2,,mse3,mse4,mse5))
```

Result shows that the MSE from using a linear model with 6 predictors chosen from 
best subset selection has average MSE of 65%. This is a high number, so we will try nonlinear functions
to predict quality.

